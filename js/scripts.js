const chicos = [
    {
        "name": "Roty",
        "region": "ciudad evita",
        "trabaja": "no",
        "pelo": "si",
        "color_de_piel": "blanco",
        "habilidad_lol": "bueno",
        "habilidad_cs": "malo",
        "es_gil": "si",
        "lore": "roba novias"
    },
    {
        "name": "Ima",
        "region": "avellaneda",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "blanquisimo",
        "habilidad_lol": "bueno",
        "habilidad_cs": "malo",
        "es_gil": "si",
        "lore": "no se sabe si es pelado"
    },
    {
        "name": "Kener",
        "region": "rosario",
        "trabaja": "no",
        "pelo": "si",
        "color_de_piel": "blanquisimo",
        "habilidad_lol": "malo",
        "habilidad_cs": "bueno",
        "es_gil": "si",
        "lore": "el nene en la nena"
    },
    {
        "name": "Juanma",
        "region": "cordoba",
        "trabaja": "si",
        "pelo": "no",
        "color_de_piel": "blanco",
        "habilidad_lol": "bueno",
        "habilidad_cs": "malo",
        "es_gil": "no",
        "lore": "bruiser"
    },
    {
        "name": "Eri",
        "region": "caseros",
        "trabaja": "si",
        "pelo": "no",
        "color_de_piel": "blanco",
        "habilidad_lol": "bueno",
        "habilidad_cs": "malo",
        "es_gil": "si",
        "lore": "milf"
    },
    {
        "name": "Crilzo",
        "region": "porteño",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "blanco",
        "habilidad_lol": "malo",
        "habilidad_cs": "malo",
        "es_gil": "no",
        "lore": "bizco"
    },
    {
        "name": "Calippy",
        "region": "el void",
        "trabaja": "no",
        "pelo": "si",
        "color_de_piel": "blanco",
        "habilidad_lol": "malo",
        "habilidad_cs": "malo",
        "es_gil": "no",
        "lore": "crazy taco"
    },
    {
        "name": "Fede",
        "region": "mar del plata",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "blanco",
        "habilidad_lol": "average",
        "habilidad_cs": "bueno",
        "es_gil": "no",
        "lore": "buena ceja"
    },
    {
        "name": "Nabu",
        "region": "san martin",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "blanco",
        "habilidad_lol": "malo",
        "habilidad_cs": "average",
        "es_gil": "no",
        "lore": "ruido de encendedor"
    },
    {
        "name": "Dano",
        "region": "avellaneda",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "blanco",
        "habilidad_lol": "average",
        "habilidad_cs": "bueno",
        "es_gil": "no",
        "lore": "maestro splinter"
    },
    {
        "name": "Sighma",
        "region": "jose c paz",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "blanco",
        "habilidad_lol": "average",
        "habilidad_cs": "malo",
        "es_gil": "si",
        "lore": "ilegal es poco"
    },
    {
        "name": "Agu",
        "region": "mar del plata",
        "trabaja": "no",
        "pelo": "no",
        "color_de_piel": "blanco",
        "habilidad_lol": "bueno",
        "habilidad_cs": "bueno",
        "es_gil": "si",
        "lore": "es buen loco"
    },
    {
        "name": "Pani",
        "region": "mar del plata",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "marronazo",
        "habilidad_lol": "malo",
        "habilidad_cs": "malo",
        "es_gil": "no",
        "lore": "se pinta las uñas y le entra a la prima"
    },
    {
        "name": "Dolla",
        "region": "ciudad evita",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "blanco",
        "habilidad_lol": "malo",
        "habilidad_cs": "malo",
        "es_gil": "si",
        "lore": "chicito"
    },
    {
        "name": "Chiru",
        "region": "ciudad evita",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "blanco",
        "habilidad_lol": "malo",
        "habilidad_cs": "malo",
        "es_gil": "no",
        "lore": "tremendo autista"
    },
    {
        "name": "Tito",
        "region": "ciudad evita",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "blanco",
        "habilidad_lol": "malo",
        "habilidad_cs": "bueno",
        "es_gil": "si",
        "lore": "casi muere"
    },
    {
        "name": "Dyrude",
        "region": "ciudad evita",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "morocho",
        "habilidad_lol": "malo",
        "habilidad_cs": "malo",
        "es_gil": "no",
        "lore": "esta mimosho"
    },
    {
        "name": "Pioox",
        "region": "wilde",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "blanco",
        "habilidad_lol": "bueno",
        "habilidad_cs": "malo",
        "es_gil": "no",
        "lore": "le re cuesta"
    },
    {
        "name": "Ficha",
        "region": "dominico",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "blanco",
        "habilidad_lol": "bueno",
        "habilidad_cs": "malo",
        "es_gil": "si",
        "lore": "acido"
    },
    {
        "name": "Kevin recke",
        "region": "caseros",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "blanco",
        "habilidad_lol": "average",
        "habilidad_cs": "bueno",
        "es_gil": "si",
        "lore": "fajaba a la jermu"
    },
    {
        "name": "Gmauro",
        "region": "ciudad evita",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "blanco",
        "habilidad_lol": "malo",
        "habilidad_cs": "average",
        "es_gil": "no",
        "lore": "gmauro"
    },
    {
        "name": "Mosta",
        "region": "mar del plata",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "morocho",
        "habilidad_lol": "malo",
        "habilidad_cs": "malo",
        "es_gil": "no",
        "lore": "tartamudea cuando se pone nervioso"
    },
    {
        "name": "Nicuco",
        "region": "mar del plata",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "blanco",
        "habilidad_lol": "malo",
        "habilidad_cs": "malo",
        "es_gil": "no",
        "lore": "el terror de chicos y grandes"
    },
    {
        "name": "Wailler",
        "region": "ciudad evita",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "blanco",
        "habilidad_lol": "malo",
        "habilidad_cs": "malo",
        "es_gil": "si",
        "lore": "no se calla nunca"
    },
    {
        "name": "kIRAX",
        "region": "wilde",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "blanco",
        "habilidad_lol": "malo",
        "habilidad_cs": "bueno",
        "es_gil": "si",
        "lore": "es facho"
    },
    {
        "name": "Fran",
        "region": "olavarria",
        "trabaja": "si",
        "pelo": "si",
        "color_de_piel": "blanco",
        "habilidad_lol": "malo",
        "habilidad_cs": "malo",
        "es_gil": "no",
        "lore": "dejo los souls para dedicarse a su falcon verde"
    }
];
const frases_chicos = [
{
   "name":"Roty",
   "frases":[
      "Te puse",
      "Tas jugando de reojo maxi, eh, la concha de tu madre"
   ]
},
{
   "name":"Ima",
   "frases":[
      "segui ehg"
   ]
},
{
   "name":"Kener",
   "frases":[
      "hijo de pootaah",
      "yo no me garcho a nadie.. mi jermu me mira",
      "puerta abierta",
      "El tio carlo",
      "Chogur con copos"
   ]
},
{
   "name":"Juanma",
   "frases":[
      "vo so loco o te hace",
      "eri pli",
      "eee medio ct b cache",
      "Tio carlo???"
   ]
},
{
   "name":"Eri",
   "frases":[
      "Y la novia para cuando?",
      "Vo le cree"
   ]
},
{
   "name":"Crilzo",
   "frases":[
      "nino vimo chico"
   ]
},
{
   "name":"Calippy",
   "frases":[
      "OugHhHGHHhHhgg"
   ]
},
{
   "name":"Fede",
   "frases":[
      "palermitano de mierda"
   ]
},
{
   "name":"Nabu",
   "frases":[
      "es todo porro, no tiene filtro"
   ]
},
{
   "name":"Dano",
   "frases":[
      "si apuntas mejor, si tenes mas armas, si te moves mas y si matas mas, tenes mas chances de ganar",
      "pichon",
      "depue te plico"
   ]
},
{
   "name":"Pani",
   "frases":[
      "ciego te vas a quedar de tanta droga, enfermo",
      "y el mono? el mono esta en tu culo"
   ]
},
{
   "name":"Dolla",
   "frases":[
      "con vos? no gracia",
      "Timagina",
      "Yo nunca te vi"
   ]
},
{
   "name":"Pioox",
   "frases":[
      "Hola amor? donde estas? manda foto"
   ]
},
{
   "name":"Ficha",
   "frases":[
      "Estas re acido.",
      "Si no es con empatia, no es humor."
   ]
},
{
   "name":"Mosta",
   "frases":[
      "hijaaaaaa de putaaaa *se larga a llorar*"
   ]
},
{
   "name":"Nicuco",
   "frases":[
      "Ahora....No te puedo.....Explicar..."
   ]
},
{
   "name":"Wailler",
   "frases":[
      "fue fue fue",
      "ehh?ahhh",
      "te calentaste"
   ]
},
{
   "name":"Mono",
   "frases":[
      "como se llama la partida?"
   ]
},
{
   "name":"Fatima, hermana de nabu",
   "frases":[
      "Yo tambien uso el ak para matar"
   ]
}]

var datatable;
var datatableFrase;


// Returns a unique item from a list each day of the year - Deterministic
function getElegidoParaFecha(chicos, fecha, offset = 0) {
  const today = fecha;

  // Get the day of the year (1-365 or 366)
  const start = new Date(today.getFullYear(), 0, 0);
  const diff = today - start;
  const oneDay = 1000 * 60 * 60 * 24;
  const dayOfYear = Math.floor(diff / oneDay);

  // Simple seed-like approach using the dayOfYear
  const seed = dayOfYear + offset;

  // Use the seed to get a "random" index
  const index = seed % chicos.length;

  // Return the item from the list
  return chicos[index];
}


const elegido = getElegidoParaFecha(chicos, new Date())

const elegido_frase = getElegidoParaFecha(frases_chicos, new Date(), 10)
const frase_hoy = getElegidoParaFecha(elegido_frase['frases'], new Date(), 10)

function initializeAutocomplete() {
    const chicosArray = chicos.map(chico => {
        return {
            label: chico.name,
            value: chico
        };
    });

    $('#autocomplete').autocomplete({
        source: chicosArray,
        lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
            var re = new RegExp('\\b' + $.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
            return re.test(suggestion.value);
        },
        select: function (event, ui) {
            event.preventDefault();

            // Make the search bar empty
            $('#autocomplete').val("")

            // Add the row to the table
            addRowGuessAutista(ui.item.value)
        },
    });

    $('#autocomplete_frase').autocomplete({
        source: chicosArray,
        lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
            var re = new RegExp('\\b' + $.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
            return re.test(suggestion.value);
        },
        select: function (event, ui) {
            event.preventDefault();

            // Make the search bar empty
            $('#autocomplete_frase').val("")

            // Add the row to the table
            addRowGuessFrase(ui.item.value)
        },
    });
}

function initializeGuessTable() {
    return new DataTable('#guesstable', {
        info: false,
        ordering: false,
        paging: false,
        searching: false,
        rowCallback: function(row, data, index) {
          rowCallback(row, data, index);
        }
    });
}

function initializeGuessTableFrase() {
    return new DataTable('#guesstable_frase', {
        info: false,
        ordering: false,
        paging: false,
        searching: false,
        rowCallback: function(row, data, index) {
          rowCallbackFrase(row, data, index);
        }
    });
}

function verify(expected, actual, row, idx) {
    if (expected == actual) {
        $(row).find('td:eq(' + idx + ')').css('background-color', 'green');
    } else {
        $(row).find('td:eq(' + idx + ')').css('background-color', 'red');
    }
}

function rowCallback(row, data, index) {
    let nombre = data[0];
    let region = data[1];
    let trabaja = data[2];
    let pelo = data[3];
    let colorPiel = data[4];
    let lol = data[5];
    let cs = data[6];
    let gil = data[7];

    verify(nombre, elegido['name'], row, 0);
    verify(region, elegido['region'], row, 1);
    verify(trabaja, elegido['trabaja'], row, 2);
    verify(pelo, elegido['pelo'], row, 3);
    verify(colorPiel, elegido['color_de_piel'], row, 4);
    verify(lol, elegido['habilidad_lol'], row, 5);
    verify(cs, elegido['habilidad_cs'], row, 6);
    verify(gil, elegido['es_gil'], row, 7);
}

function rowCallbackFrase(row, data, index) {
    let nombre = data[0];
    verify(nombre, elegido_frase['name'], row, 0);
}

function addRowGuessAutista(chico) {
    $("#guesstable").show();

    datatable
        .row
        .add([
            chico['name'],
            chico['region'],
            chico['trabaja'],
            chico['pelo'],
            chico['color_de_piel'],
            chico['habilidad_lol'],
            chico['habilidad_cs'],
            chico['es_gil']
        ])
        .draw(false);
}

function addRowGuessFrase(chico) {
    $("#guesstable_frase").show();
    datatableFrase
        .row
        .add([
            chico['name']
        ])
        .draw(false);
}

function getAutistaDeAyer() {
    var date = new Date();
    date.setDate(date.getDate() - 1);
    let elegidoAyer = getElegidoParaFecha(chicos, date)
    return "El autista de ayer fue " + elegidoAyer['name'];
}

function getFraseDeAyer() {
    var date = new Date();
    date.setDate(date.getDate() - 1);
    let elegidoAyer = getElegidoParaFecha(frases_chicos, date, 10)
    let fraseAyer =  getElegidoParaFecha(elegidoAyer['frases'], date, 10)
    return "Frase de ayer: " + fraseAyer;
}

$(document).ready(function () {
    initializeAutocomplete();
    datatable = initializeGuessTable();
    datatableFrase = initializeGuessTableFrase();

    $("#autista_de_ayer").text(getAutistaDeAyer());
    $("#frase_de_ayer").text(getFraseDeAyer());

    $("#frase_hoy").text(frase_hoy);
})


function mostrarPista() {
    $("#pista").text(elegido['lore'])
}